<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>CPU Raymarcher with Checkerboard</title>
  <style>canvas {display: block; }</style>
</head>
<body>
<canvas id="canvas"></canvas>
<script>
console.log(navigator.hardwareConcurrency+' threads');
document.getElementById('canvas').width=screen.width*window.devicePixelRatio;
document.getElementById('canvas').height=screen.height*window.devicePixelRatio;
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const imageData = ctx.createImageData(canvas.width, canvas.height);
const data = imageData.data;

function renderTasks() {
  const w = canvas.width;
  const h = canvas.height;
  const MP = Math.floor((w*h)/1000/100);
  console.log(MP/10+' MPixel');
  const linesPerWorker = Math.floor(h/navigator.hardwareConcurrency);
  for (let y = 0; y < h; y+=linesPerWorker) 
	{
    var myWorker = new Worker('worker.js');
    myWorker.addEventListener('message', function(e) {
    //console.log(e.data);
      i=new ImageData(e.data, w, linesPerWorker);
      ctx.putImageData(i, 0, y);
    }, false);
    myWorker.postMessage([w, h, y, linesPerWorker]);
  }
}
renderTasks();
</script>
</body>
</html>
